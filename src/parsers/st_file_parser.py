"""
    –ú–æ–¥—É–ª—å st_file_parser.py

    –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ (ST-—Ñ–∞–π–ª–æ–≤)
    —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ANTLR4. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
    1. –ß—Ç–µ–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ST-—Ñ–∞–π–ª–æ–≤
    2. –£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—à–∞–±–ª–æ–Ω–æ–≤ –∏ –ø–∞–ø–æ–∫)
    3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ñ–∞–π–ª

    –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
    - STFileParserWrapper: –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
    - ExceptionErrorListener: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞
    - StructureListener: —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞
"""

import os
# –ò–º–ø–æ—Ä—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ ANTLR
from antlr4 import FileStream, CommonTokenStream, ParseTreeWalker
from antlr4.error.ErrorListener import ErrorListener
from src.ANTLR4.STFileLexer import STFileLexer
from src.ANTLR4.STFileParser import STFileParser
from src.ANTLR4.STFileListener import STFileListener
# ===================================================================
# –ö–õ–ê–°–°–´ –î–õ–Ø –ü–ê–†–°–ò–ù–ì–ê ST-–§–ê–ô–õ–û–í
# ===================================================================

class STFileParserWrapper:
    """
        –ö–ª–∞—Å—Å-–æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞ ST (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã).

        –û—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
        --------------------
        STFileParserWrapper –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å ST-—Ñ–∞–π–ª–∞–º–∏, —Ç–∞–∫–∏—Ö –∫–∞–∫ –ø–∞—Ä—Å–∏–Ω–≥, –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —É–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –∏ –ø–∞–ø–æ–∫, –∞ —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ñ–∞–π–ª. –ö–ª–∞—Å—Å –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤—Å–µ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã —Å AST, –ª–µ–∫—Å–∏—á–µ—Å–∫–∏–º –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–º –∞–Ω–∞–ª–∏–∑–æ–º, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —É–¥–æ–±–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

        –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
        ---------------------
        - **–ü–∞—Ä—Å–∏–Ω–≥ ST-—Ñ–∞–π–ª–∞:**
          –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç ST-—Ñ–∞–π–ª –≤ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É Python-—Å–ª–æ–≤–∞—Ä—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö –ø–∞–ø–æ–∫ –∏ —à–∞–±–ª–æ–Ω–æ–≤. –ö–æ—Ä–Ω–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–µ–Ω—É–µ—Ç—Å—è –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è).
        - **–£–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –∏ –ø–∞–ø–æ–∫:**
          –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–∞–ª—è—Ç—å —à–∞–±–ª–æ–Ω—ã (template) –∏ –ø–∞–ø–∫–∏ (folder) –ø–æ –∏–º–µ–Ω–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö.
        - **–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**
          –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞ —Ä–µ–∞–ª–∏–∑—É—é—Ç –≥–∏–±–∫—É—é —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–∞–ø–æ–∫ –∏ —Å–ª–æ–∂–Ω–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏.
        - **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è ST-—Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ:**
          –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Python –≤ —Ñ–æ—Ä–º–∞—Ç ST —Å–æ–≥–ª–∞—Å–Ω–æ –≥—Ä–∞–º–º–∞—Ç–∏–∫–µ STFile.g4, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º –≤–∏–¥–µ.
        - **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
          –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–∂–µ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
        - **–õ—ë–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
          –ö–ª–∞—Å—Å –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –±–ª–∞–≥–æ–¥–∞—Ä—è —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º –º–µ—Ç–æ–¥–∞–º –∏ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

        –ú–µ—Ç–æ–¥—ã:
        -------
        - `parse_st_file(file_path)`: –ü–∞—Ä—Å–∏—Ç ST-—Ñ–∞–π–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∏–º—è –∫–æ—Ä–Ω—è.
        - `remove_template(file_path, template_name)`: –£–¥–∞–ª—è–µ—Ç —à–∞–±–ª–æ–Ω –ø–æ –∏–º–µ–Ω–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è.
        - `remove_folder(file_path, folder_name)`: –£–¥–∞–ª—è–µ—Ç –ø–∞–ø–∫—É –ø–æ –∏–º–µ–Ω–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è.
        - `_remove_from_structure(structure, filter_fn)`: –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é.
        - `_save_structure(file_path, structure)`: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ñ–∞–π–ª.
        - `_generate_st_content(structure)`: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ ST-—Ñ–∞–π–ª–∞ –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Python.

        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
        --------------
        –ö–ª–∞—Å—Å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å ST-—Ñ–∞–π–ª–∞–º–∏ –≤ —Å–∏—Å—Ç–µ–º–µ, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º, –∏—Ö –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∞ —Ç–∞–∫–∂–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∏–ª–∏ –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

        –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
        -----------
        –ú–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞ –≤—ã–±—Ä–∞—Å—ã–≤–∞—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (ValueError, IOError) –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–æ–∫ —á—Ç–µ–Ω–∏—è, –∑–∞–ø–∏—Å–∏ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–∞, —á—Ç–æ –æ–±–ª–µ–≥—á–∞–µ—Ç –æ—Ç–ª–∞–¥–∫—É –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

        –ü—Ä–∏–º–µ—Ä:
        -------
            parser = STFileParserWrapper()
            structure = parser.parse_st_file('example.st')
            parser.remove_template('example.st', 'SomeTemplate')
            parser.remove_folder('example.st', 'SomeFolder')
        """
    def parse_st_file(self, file_path) -> dict:
        """
           –ü–∞—Ä—Å–∏—Ç ST-—Ñ–∞–π–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

           –î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–∑–±–æ—Ä (–ø–∞—Ä—Å–∏–Ω–≥) —Ñ–∞–π–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ST (Structured Text) –∏ —Å—Ç—Ä–æ–∏—Ç –µ–≥–æ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.
           –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä—Å–µ—Ä, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ ANTLR, –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å, —Å–æ–±–∏—Ä–∞—é—â–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
           –≤–æ –≤—Ä–µ–º—è –æ–±—Ö–æ–¥–∞ –¥–µ—Ä–µ–≤–∞ —Ä–∞–∑–±–æ—Ä–∞.

           –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
               file_path (str): –ü—É—Ç—å –∫ ST-—Ñ–∞–π–ª—É, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å. –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Ñ–∞–π–ª –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω –≤ UTF-8.

           –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
               dict: –°–ª–æ–≤–∞—Ä—å —Å –¥–≤—É–º—è –∫–ª—é—á–∞–º–∏:
                   - 'structure': –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ (–æ–±—ã—á–Ω–æ —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏/—Å–ø–∏—Å–∫–∏),
                   –ø–æ–ª—É—á–µ–Ω–Ω–∞—è —Å –ø–æ–º–æ—â—å—é —Å–ª—É—à–∞—Ç–µ–ª—è StructureListener.
                   - 'root_name': –∏–º—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞, —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

           –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
               - –í —Å–ª—É—á–∞–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –ª—é–±–æ–π –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏),
               –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "–ø—É—Å—Ç—É—é" —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫) –∏ –∏–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.
               - –î–ª—è —Ä–∞–∑–±–æ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–ª–∞—Å—Å—ã FileStream, STFileLexer, STFileParser, StructureListener –∏ ParseTreeWalker,
               –∞ —Ç–∞–∫–∂–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ ExceptionErrorListener.
               - –ò–º—è –∫–æ—Ä–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –∏–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

           –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
               –í—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –Ω–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞—Ä—É–∂—É ‚Äî –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

           –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
               result = parser.parse_st_file("example.st")
               print(result['structure'])
               print(result['root_name'])
           """
        try:
            # –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–¥–∏—Ä–æ–≤–∫–∏
            input_stream = FileStream(file_path, encoding="utf-8")
            # –õ–µ–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
            lexer = STFileLexer(input_stream)
            tokens = CommonTokenStream(lexer)
            # –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
            parser = STFileParser(tokens)

            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
            parser.removeErrorListeners()
            parser.addErrorListener(ExceptionErrorListener())
            # –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞
            tree = parser.fileStructure()
            # –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª—è
            listener = StructureListener()
            file_name = os.path.splitext(os.path.basename(file_path))[0]
            listener.root_name = file_name  # –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ò–º—è —Ñ–∞–π–ª–∞ –≤ listener
            # –û–±—Ö–æ–¥ –¥–µ—Ä–µ–≤–∞ —Ä–∞–∑–±–æ—Ä–∞
            ParseTreeWalker().walk(listener, tree)

            return {
                'structure': listener.get_structure(),
                'root_name': listener.root_name
            }
        except Exception as e:
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
            return {
                'structure': [],
                'root_name': os.path.splitext(os.path.basename(file_path))[0]
            }

    # –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥—ã –≤ STFileParserWrapper:
    def remove_template(self, file_path, template_name) -> None:
        """
            –£–¥–∞–ª—è–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω (template) –∏–∑ ST-—Ñ–∞–π–ª–∞.

            –î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞ Structured Text (ST).
            –ü—Ä–æ—Ü–µ—Å—Å –≤–∫–ª—é—á–∞–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞,
            –∞ –∑–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ñ–∞–π–ª.

            –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
                file_path (str): –ü—É—Ç—å –∫ ST-—Ñ–∞–π–ª—É, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω.
                template_name (str): –ò–º—è —à–∞–±–ª–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞.

            –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
                None

            –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
                ValueError: –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∏–ª–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ —Ç.–ø.).
                IOError: –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞, —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∏ —Ç.–¥.).

            –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:
                1. –ü–∞—Ä—Å–∏—Ç —Ñ–∞–π–ª –∏ –ø–æ–ª—É—á–∞–µ—Ç –µ–≥–æ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ self.parse_st_file(file_path).
                2. –ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω–∞, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç ValueError.
                3. –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —É–¥–∞–ª—è—è –∏–∑ –Ω–µ–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ç–∏–ø–∞ 'template' —Å –∏–º–µ–Ω–µ–º, —Å–æ–≤–ø–∞–¥–∞—é—â–∏–º —Å template_name ‚Äî –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ _remove_from_structure.
                4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ —Ñ–∞–π–ª —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ _save_structure.

            –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
                - –ú–µ—Ç–æ–¥ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.
                - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞: parse_st_file, _remove_from_structure –∏ _save_structure.
                - –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ —à–∞–±–ª–æ–Ω–æ–≤.
                - –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ —á—Ç–µ–Ω–∏—è –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

            –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
                parser.remove_template("my_program.st", "MyTemplate")
            """
        structure = self.parse_st_file(file_path)
        if not structure:
            raise ValueError(f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª {file_path}")
        # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—É–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞)
        new_structure = self._remove_from_structure(
            structure,
            lambda x: not (x['type'] == 'template' and x['name'] == template_name)
        )
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        self._save_structure(file_path, new_structure)

    def remove_folder(self, file_path, folder_name) -> None:
        """
        –£–¥–∞–ª—è–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–∞–ø–∫—É (folder) –∏–∑ ST-—Ñ–∞–π–ª–∞.

        –î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ –ø–∞–ø–∫–∏ —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ST-—Ñ–∞–π–ª–∞ (Structured Text).
        –û–ø–µ—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å —Ü–µ–ª—å—é –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–∞–ø–∫–∏ (–∏ –≤—Å–µ–≥–æ –µ—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ),
        –∞ –∑–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ñ–∞–π–ª.

        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
            file_path (str): –ü—É—Ç—å –∫ ST-—Ñ–∞–π–ª—É, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å –ø–∞–ø–∫—É.
            folder_name (str): –ò–º—è –ø–∞–ø–∫–∏, –∫–æ—Ç–æ—Ä—É—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å.

        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            None

        –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
            ValueError: –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∏–ª–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω).
            IOError: –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–ø–∏—Å–∏).

        –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:
            1. –ü–∞—Ä—Å–∏—Ç ST-—Ñ–∞–π–ª —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ self.parse_st_file(file_path) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
            2. –ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ –ø–æ–ª—É—á–µ–Ω–∞, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ ValueError.
            3. –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —É–¥–∞–ª—è—è –∏–∑ –Ω–µ—ë —ç–ª–µ–º–µ–Ω—Ç—ã —Ç–∏–ø–∞ 'folder' —Å –∏–º–µ–Ω–µ–º, —Å–æ–≤–ø–∞–¥–∞—é—â–∏–º —Å folder_name,
                –∏—Å–ø–æ–ª—å–∑—É—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ _remove_from_structure.
            4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ–±—Ä–∞—Ç–Ω–æ –≤ –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª —Å –ø–æ–º–æ—â—å—é _save_structure.

        –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
            - –ú–µ—Ç–æ–¥ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.
            - –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è, –∏—Å–∫–ª—é—á–∞—é—â–∞—è –Ω—É–∂–Ω—É—é –ø–∞–ø–∫—É –ø–æ –∏–º–µ–Ω–∏ –∏ —Ç–∏–ø—É.
            - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞: parse_st_file, _remove_from_structure, _save_structure.
            - –í —Å–ª—É—á–∞–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π —á—Ç–µ–Ω–∏—è –∏–ª–∏ –∑–∞–ø–∏—Å–∏, –æ–Ω–∏ —è–≤–Ω–æ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –≤—ã–∑—ã–≤–∞—é—â–µ–º—É –∫–æ–¥—É.

        –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
            parser.remove_folder("program.st", "ConfigFolder")
        """
        structure = self.parse_st_file(file_path)
        if not structure:
            raise ValueError(f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª {file_path}")
        # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—É–¥–∞–ª–µ–Ω–∏–µ –ø–∞–ø–∫–∏)
        new_structure = self._remove_from_structure(
            structure,
            lambda x: not (x['type'] == 'folder' and x['name'] == folder_name)
        )
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        self._save_structure(file_path, new_structure)

    def _remove_from_structure(self, structure, filter_fn):

        """
           –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É ST-—Ñ–∞–π–ª–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏-—Ñ–∏–ª—å—Ç—Ä—É.

           –î–∞–Ω–Ω—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ST-—Ñ–∞–π–ª–∞
           –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é. –ú–µ—Ç–æ–¥ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞–ø–æ–∫ –∏–ª–∏ —à–∞–±–ª–æ–Ω–æ–≤, –ø—Ä–æ—Ö–æ–¥—è –ø–æ –≤—Å–µ–π
           —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, –≤–∫–ª—é—á–∞—è –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏, –∏ –∏—Å–∫–ª—é—á–∞—è —Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö filter_fn –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç False.

           –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
               structure (dict): –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å. –û–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ –æ–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á 'structure'
                                 (—Å–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è), –∞ —É –ø–∞–ø–æ–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–ª—é—á 'children'.
               filter_fn (callable): –§—É–Ω–∫—Ü–∏—è-—Ñ–∏–ª—å—Ç—Ä, –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è —ç–ª–µ–º–µ–Ω—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è True, –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç
                                     –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω, –∏ False ‚Äî –µ—Å–ª–∏ –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–¥–∞–ª—ë–Ω.

           –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
               dict: –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –Ω–µ –ø—Ä–æ—à–µ–¥—à–∏–µ —Ñ–∏–ª—å—Ç—Ä, –≤–∫–ª—é—á–∞—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ.

           –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:
               1. –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –ø–æ–º–æ—â—å—é filter_fn.
               2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ç–∏–ø–∞ 'folder' —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–µ–±—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (children).
               3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

           –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
               - –ú–µ—Ç–æ–¥ –∏–∑–º–µ–Ω—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É "–Ω–∞ –º–µ—Å—Ç–µ" (in-place), —Ç–æ –µ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Å–ª–æ–≤–∞—Ä—å ‚Äî —ç—Ç–æ —Ç–∞ –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞,
                 —á—Ç–æ –∏ –±—ã–ª–∞ –ø–µ—Ä–µ–¥–∞–Ω–∞ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ, –Ω–æ —É–∂–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–∞—è.
               - –ú–µ—Ç–æ–¥ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –¥–ª—è –≤—Å–µ—Ö –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–∞–ø–æ–∫, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–∞–ª—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ –ª—é–±–æ–º —É—Ä–æ–≤–Ω–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.
               - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤, –ø–∞–ø–æ–∫ –∏ –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ —É—Å–ª–æ–≤–∏—é.
               - filter_fn –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–æ–π—á–∏–≤—ã–º –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–∂–∏–¥–∞—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–π 'type', 'name', –∏ —Ç.–¥.).

           –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
               filtered = self._remove_from_structure(structure, lambda x: x['type'] != 'template')

           –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
               –ú–µ—Ç–æ–¥ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è ‚Äî –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–º–µ–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ filter_fn —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫.
           """
        # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
        structure['structure'] = [
            item for item in structure['structure']
            if filter_fn(item)
        ]
        # –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–∞–ø–æ–∫
        for item in structure['structure']:
            if item['type'] == 'folder':
                item['children'] = self._remove_from_structure(item, filter_fn)
        return structure

    #TODO - —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –º–µ—Ç–æ–¥ _save_structure –≤ –∫–ª–∞—Å—Å FileManager
    def _save_structure(self, file_path, structure):
        """
            –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ST-—Ñ–∞–π–ª–∞ –Ω–∞ –¥–∏—Å–∫.

            –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–æ–±—ã—á–Ω–æ –ø–æ–ª—É—á–µ–Ω–Ω—É—é –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏/–∏–ª–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ ST-—Ñ–∞–π–ª–∞)
            –≤ —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Structured Text —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ _generate_st_content –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ñ–∞–π–ª. –ï—Å–ª–∏ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º –∏–ª–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π),
            –≤–æ–∑–±—É–∂–¥–∞–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ IOError —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º.

            –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
                file_path (str): –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É, –≤ –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É.
                structure (dict): –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—É—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.
                                  –û–±—ã—á–Ω–æ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã –º–µ—Ç–æ–¥–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–ª–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞.

            –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
                None

            –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
                IOError: –í–æ–∑–Ω–∏–∫–∞–µ—Ç, –µ—Å–ª–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å,
                         –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è, –¥–∏—Å–∫ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω –∏ —Ç.–ø.).

            –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:
                1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ ST-—Ñ–∞–π–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –ø–æ–º–æ—â—å—é _generate_st_content(structure).
                2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø—É—Ç–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ UTF-8.
                3. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —Ñ–∞–π–ª.
                4. –í —Å–ª—É—á–∞–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –ª—é–±–æ–π –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏–ª–∏ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞ –≤–æ–∑–±—É–∂–¥–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ IOError.

            –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
                - –ú–µ—Ç–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
                - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ ST-—Ñ–∞–π–ª–∞ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º—É –º–µ—Ç–æ–¥—É _generate_st_content.
                - –õ—é–±–∞—è –æ—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ IOError —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

            –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
                self._save_structure("program.st", structure)
            """
        content = self._generate_st_content(structure)
        try:
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(content)
        except Exception as e:
            raise IOError(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞: {str(e)}")


    def _generate_st_content(self, structure):
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ ST-—Ñ–∞–π–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–≥–ª–∞—Å–Ω–æ –≥—Ä–∞–º–º–∞—Ç–∏–∫–µ STFile.g4.

        –î–∞–Ω–Ω—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (—Å–ª–æ–≤–∞—Ä—å —Å –ø–∞–ø–∫–∞–º–∏ –∏ —à–∞–±–ª–æ–Ω–∞–º–∏), –ø–æ–ª—É—á–µ–Ω–Ω—É—é
        –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–ª–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ ST-—Ñ–∞–π–ª–∞, –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Ñ–æ—Ä–º–∞—Ç—É Structured Text,
        –æ–ø–∏—Å–∞–Ω–Ω–æ–º—É –≤ –≥—Ä–∞–º–º–∞—Ç–∏–∫–µ STFile.g4. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ —Ñ–∞–π–ª.

        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
            structure (dict): –°—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —Å—Ç—Ä–æ–∫—É. –û–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç
                              –∫–ª—é—á 'content' —Å –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–æ–π, –∞ –¥–∞–ª–µ–µ ‚Äî –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏ –∏ —à–∞–±–ª–æ–Ω—ã.

        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            str: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å—Ç—Ä–æ–∫–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Structured Text, –≥–æ—Ç–æ–≤–æ–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫.

        –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:
            1. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è build_folder(folder) –æ–±—Ö–æ–¥–∏—Ç –¥–µ—Ä–µ–≤–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
                - –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Ç–∏–ø–∞ 'folder', —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–∞–ø–∫–∏ –∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–µ–±—è –¥–ª—è –µ—ë –ø–æ—Ç–æ–º–∫–æ–≤.
                - –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Ç–∏–ø–∞ 'template', —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É —à–∞–±–ª–æ–Ω–∞ —Å –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º.
                - –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫—É, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É STFile.g4.
            2. –ú–µ—Ç–æ–¥ –Ω–∞—á–∏–Ω–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏, –ø–æ–ª—É—á–∞—è –µ—ë –∏–∑ structure['content'].
            3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä–æ–∫—É, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –≤ —Ñ–∞–π–ª.

        –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
            - –§–æ—Ä–º–∞—Ç —Å—Ç—Ä–æ–∫–∏ —Å—Ç—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–µ STFile.g4 —Å —Ñ–∏–≥—É—Ä–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏.
            - –í–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–∞–ø–æ–∫ –∏ —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ.
            - –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä–æ–∫—É.
            - –ú–µ—Ç–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –æ–±—ã—á–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ —Ñ–∞–π–ª.

        –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
            content = self._generate_st_content(structure)
            with open("file.st", "w", encoding="utf-8") as f:
                f.write(content)

        –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
            –ú–µ—Ç–æ–¥ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É.
        """
        def build_folder(folder):
            children = []
            for child in folder.get('children', []):
                if child['type'] == 'folder':
                    children.append(
                        f'{{1, {{"{child["name"]}", 1, 0, "", ""}}, [\n'
                        f'{build_folder(child)}\n'
                        ']}'
                    )
                elif child['type'] == 'template':
                    children.append(
                        f'{{0, {{"{child["name"]}", 0, 1, "", "{child["content"]}"}}}}'
                    )
            return ',\n'.join(children)

        root_folder = structure['content']
        return (
            f'{{1, {{"{root_folder["name"]}", 1, 0, "", ""}}, [\n'
            f'{build_folder(root_folder)}\n'
            ']}'
        )

    def parse_st_metadata(self, file_path: str, first_lines: list) -> dict:
        """–ü–∞—Ä—Å–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ ST-—Ñ–∞–π–ª–∞ (—à–∞–±–ª–æ–Ω—ã/–ø–∞–ø–∫–∏)"""
        #  TODO üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ: 22.08.2025 - –º–µ—Ç–æ–¥ parse_st_metadata –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç
        return {
            "name": os.path.basename(file_path),
            "type": "file",
            "size": os.path.getsize(file_path),
            "last_modified": os.path.getmtime(file_path),
            # –î–æ–ø. –ø–æ–ª—è –¥–ª—è ST-—Ñ–∞–π–ª–æ–≤
            "has_templates": "template" in first_lines[0]
        }

    # –ø–∞—Ä—Å–∏–Ω–≥ st —Ñ–∞–π–ª–æ–≤ –¥–ª—è metadata_cache

    def parse_st_metadata_level2(self, file_path) -> dict:
        """
        –ü–∞—Ä—Å–∏—Ç ST-—Ñ–∞–π–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ–ø—É—Å–∫–∞—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ template –±–ª–æ–∫–æ–≤
        –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—è—Å—å –≤—Ç–æ—Ä—ã–º —É—Ä–æ–≤–Ω–µ–º –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.
        """

        try:
            input_stream = FileStream(file_path, encoding="utf-8")
            lexer = STFileLexer(input_stream)
            tokens = CommonTokenStream(lexer)
            parser = STFileParser(tokens)

            parser.removeErrorListeners()
            parser.addErrorListener(ExceptionErrorListener())
            tree = parser.fileStructure()

            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
            listener = MetadataStructureListener()
            file_name = os.path.splitext(os.path.basename(file_path))[0]
            listener.root_name = file_name

            ParseTreeWalker().walk(listener, tree)

            # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≥–ª—É–±–∏–Ω—É
            full_structure = listener.get_structure()
            limited_structure = self._limit_depth_level2(full_structure)

            return {
                'structure': limited_structure,
                'root_name': listener.root_name
            }
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ: {e}")
            return {
                'structure': [],
                'root_name': os.path.splitext(os.path.basename(file_path))[0]
            }


    def _limit_depth_level2(self, structure, current_level=1):
        """
        –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Ç–æ—Ä—ã–º —É—Ä–æ–≤–Ω–µ–º –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.
        """
        if current_level > 2:
            return []

        limited_structure = []
        for item in structure:
            if item['type'] == 'folder':
                # –î–ª—è –ø–∞–ø–æ–∫ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≥–ª—É–±–∏–Ω—É –¥–µ—Ç–µ–π
                limited_item = item.copy()
                limited_item['children'] = self._limit_depth_level2(item['children'], current_level + 1)
                limited_structure.append(limited_item)
            else:
                # –î–ª—è —à–∞–±–ª–æ–Ω–æ–≤ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                limited_structure.append(item)
        return limited_structure

class ExceptionErrorListener(ErrorListener):
    """
        –ö–∞—Å—Ç–æ–º–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è ANTLR.
        –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ—à–∏–±–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è Python —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º.
    """
    def syntaxError(self, recognizer, offendingSymbol, line, column, msg, e):
        """
                –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏.

                –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
                - recognizer: —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å, –æ–±–Ω–∞—Ä—É–∂–∏–≤—à–∏–π –æ—à–∏–±–∫—É
                - offendingSymbol: –æ—à–∏–±–æ—á–Ω—ã–π —Å–∏–º–≤–æ–ª
                - line: –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ —Å –æ—à–∏–±–∫–æ–π
                - column: –ø–æ–∑–∏—Ü–∏—è –≤ —Å—Ç—Ä–æ–∫–µ
                - msg: —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                - e: –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        """
        raise Exception(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ —Å—Ç—Ä–æ–∫–µ {line}:{column} - {msg}")

class StructureListener(STFileListener):

    """
       StructureListener ‚Äî —ç—Ç–æ —Å–ª—É—à–∞—Ç–µ–ª—å –ø–∞—Ä—Å–µ—Ä–∞ ANTLR, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ST-—Ñ–∞–π–ª–∞
       –≤ –≤–∏–¥–µ –¥–µ—Ä–µ–≤–∞ Python-–æ–±—ä–µ–∫—Ç–æ–≤.

       –û—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
           - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ ST (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞–ø–∫–∏ –∏ —à–∞–±–ª–æ–Ω—ã).
           - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–ø–∞–ø–∫–∏ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø–∞–ø–∫–∏ –∏ —à–∞–±–ª–æ–Ω—ã).
           - –£–¥–æ–±–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

       –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
           - –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å—Ç–µ–∫, –≥–¥–µ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç ‚Äî —ç—Ç–æ —Ç–µ–∫—É—â–∏–π —Ä–æ–¥–∏—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞–ø–∫–∞).
           - –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ –ø–∞–ø–∫—É –∏–ª–∏ —à–∞–±–ª–æ–Ω (–º–µ—Ç–æ–¥ enterEntry) —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—ä–µ–∫—Ç (—Å–ª–æ–≤–∞—Ä—å) –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è
                –≤ –¥–µ—Ä–µ–≤–æ, –∞ –¥–ª—è –ø–∞–ø–æ–∫ ‚Äî –µ—â—ë –∏ –≤ —Å—Ç–µ–∫ (—á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å).
           - –î–ª—è –ø–∞–ø–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥ –≤–Ω—É—Ç—Ä—å (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å—Ç–µ–∫), –∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ (exitEntry) ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –∫ —Ä–æ–¥–∏—Ç–µ–ª—é
                (–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ —Å—Ç–µ–∫–∞).
           - –î–ª—è —à–∞–±–ª–æ–Ω–æ–≤ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∏—Ö –∏–º—è –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å.
           - –ú–µ—Ç–æ–¥ get_structure –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –≤–∏–¥–µ –¥–µ—Ä–µ–≤–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤–∞—Ä–µ–π.

       –ê—Ç—Ä–∏–±—É—Ç—ã:
           stack: list ‚Äî —Å—Ç–µ–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–ø–∞–ø–æ–∫).
           current_parent: dict ‚Äî —Ç–µ–∫—É—â–∏–π —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç, –≤ –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –ø–∞–ø–∫–∏ –∏–ª–∏ —à–∞–±–ª–æ–Ω—ã.
           root_name: str ‚Äî –∏–º—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "Unnamed").
           found_root: bool ‚Äî —Ñ–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –Ω–∞–π–¥–µ–Ω –ª–∏ –∫–æ—Ä–Ω–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç.

       –ú–µ—Ç–æ–¥—ã:
           __init__(): –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–µ–∫–∞ –∏ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞.
           get_structure(): –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ä–µ–≤–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞.
           enterEntry(ctx): –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥–∞ –≤ —ç–ª–µ–º–µ–Ω—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–ø–∞–ø–∫—É –∏–ª–∏ —à–∞–±–ª–æ–Ω).
           exitEntry(ctx): –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–¥–ª—è –ø–∞–ø–æ–∫ ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –∫ —Ä–æ–¥–∏—Ç–µ–ª—é).
       """
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª—É—à–∞—Ç–µ–ª—è —Å –ø—É—Å—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π."""
        self.stack = [{'children': []}]             # –°—Ç–µ–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        self.current_parent = self.stack[0]         # –¢–µ–∫—É—â–∏–π —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
        self.root_name = "Unnamed"                  # –ò–º—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
        self.found_root = False                     # –§–ª–∞–≥ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞


    def get_structure(self):
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É ST-—Ñ–∞–π–ª–∞, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–∞—Ä—Å–∏–Ω–≥–∞.

        –ú–µ—Ç–æ–¥ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞ –≤ –≤–∏–¥–µ –¥–µ—Ä–µ–≤–∞,
        –≥–¥–µ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Å–ª–æ–≤–∞—Ä—ë–º —Å –∫–ª—é—á–∞–º–∏ 'name', 'type', 'children' (–¥–ª—è –ø–∞–ø–æ–∫)
        –∏–ª–∏ 'name', 'type', 'content' (–¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤). –ö–æ—Ä–Ω–µ–≤—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —è–≤–ª—è–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫,
        —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –ø–∞–ø–∫–∏ –∏ —à–∞–±–ª–æ–Ω—ã.

        Returns:
            list: –°–ø–∏—Å–æ–∫ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–ø–∞–ø–æ–∫ –∏ —à–∞–±–ª–æ–Ω–æ–≤) –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞.
        """
        return self.stack[0]['children']


    def enterEntry(self, ctx):
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥ –≤ —ç–ª–µ–º–µ–Ω—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ST-—Ñ–∞–π–ª–∞ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ –¥–µ—Ä–µ–≤–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞.

        –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ (–ø–∞–ø–∫–∞ –∏–ª–∏ —à–∞–±–ª–æ–Ω), –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—ä–µ–∫—Ç –≤ —Ç–µ–∫—É—â–µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è:
          - –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–ø–∫–∏ (folderHeader), —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –ø–∞–ø–∫–∏ —Å –∏–º–µ–Ω–µ–º,
            –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ —Å–ø–∏—Å–æ–∫ –¥–µ—Ç–µ–π —Ç–µ–∫—É—â–µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è, –∞ —Ç–∞–∫–∂–µ –ø–æ–º–µ—â–∞–µ—Ç –≤ —Å—Ç–µ–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.
            –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ç–µ–∫—É—â–∏–π —Ä–æ–¥–∏—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤—É—é –ø–∞–ø–∫—É.
          - –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ —à–∞–±–ª–æ–Ω–∞ (templateHeader), –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–º—è —à–∞–±–ª–æ–Ω–∞ –∏ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (–µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å),
            –∑–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è–µ—Ç —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω –≤ —Å–ø–∏—Å–æ–∫ –¥–µ—Ç–µ–π —Ç–µ–∫—É—â–µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.

        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            ctx: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç ANTLR –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–ø–∏—Å–∏ (entry), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –¥–æ—Å—Ç—É–ø –∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º –ø–∞–ø–æ–∫ –∏ —à–∞–±–ª–æ–Ω–æ–≤.

        –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –¥–æ–±–∞–≤–ª—è–µ–º–æ–π –≤ –¥–µ—Ä–µ–≤–æ:
            –î–ª—è –ø–∞–ø–∫–∏:
                {
                    'name': <–∏–º—è –ø–∞–ø–∫–∏>,
                    'type': 'folder',
                    'children': []
                }
            –î–ª—è —à–∞–±–ª–æ–Ω–∞:
                {
                    'name': <–∏–º—è —à–∞–±–ª–æ–Ω–∞>,
                    'type': 'template',
                    'content': <—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —à–∞–±–ª–æ–Ω–∞>
                }
        """
        if ctx.folderHeader():
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–ø–∫–∏
            header = ctx.folderHeader()
            name = header.STRING(0).getText()[1:-1]   # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ (—É–¥–∞–ª—è–µ–º –∫–∞–≤—ã—á–∫–∏)

            # –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–∞–ø–∫–∏
            new_item = {
                'name': name,
                'type': 'folder',
                'children': []
            }
            # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Ç–µ–∫—É—â–µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–µ–∫–∞
            self.current_parent['children'].append(new_item)
            self.stack.append(new_item)
            self.current_parent = new_item



        elif ctx.templateHeader():
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ —à–∞–±–ª–æ–Ω–∞
            header = ctx.templateHeader()
            name = header.STRING(0).getText()[1:-1]    # –ò–º—è —à–∞–±–ª–æ–Ω–∞
            # –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —à–∞–±–ª–æ–Ω–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            content = header.STRING(2).getText()[1:-1] if len(header.STRING()) > 1 else ""

            # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –≤ —Ç–µ–∫—É—â–µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è
            self.current_parent['children'].append({
                'name': name,
                'type': 'template',
                'content': content
            })

    def exitEntry(self, ctx):
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã—Ö–æ–¥ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ST-—Ñ–∞–π–ª–∞ –ø—Ä–∏ –æ–±—Ö–æ–¥–µ –¥–µ—Ä–µ–≤–∞ —Ä–∞–∑–±–æ—Ä–∞.

        –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–∞—Ä—Å–µ—Ä–æ–º ANTLR –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –ï—Å–ª–∏ –≤—ã—Ö–æ–¥ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –∏–∑ –ø–∞–ø–∫–∏,
        –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏:
            - –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç ‚Äî –ø–∞–ø–∫–∞ (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ ctx.folderHeader()), –∏ –≤ —Å—Ç–µ–∫–µ –µ—Å—Ç—å –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞,
              —Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ —Å—Ç–µ–∫–∞, –∞ —Ç–µ–∫—É—â–∏–π —Ä–æ–¥–∏—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –≤ —Å—Ç–µ–∫–µ.
            - –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            ctx: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç ANTLR –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–ø–∏—Å–∏ (entry), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ —ç–ª–µ–º–µ–Ω—Ç–∞.

        –ü—Ä–∏–º–µ—Ä:
            –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –≤–ª–æ–∂–µ–Ω–Ω–æ–π –ø–∞–ø–∫–∏ –º–µ—Ç–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
        """
        if ctx.folderHeader() and len(self.stack) > 1:
            # –î–ª—è –ø–∞–ø–∫–∏: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Ä–æ–¥–∏—Ç–µ–ª—é
            self.stack.pop()
            self.current_parent = self.stack[-1]

class MetadataStructureListener(StructureListener):
    def __init__(self):
        super().__init__()

    def enterEntry(self, ctx):
        """
            –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥ –≤ —ç–ª–µ–º–µ–Ω—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ST-—Ñ–∞–π–ª–∞, —Å–æ–±–∏—Ä–∞—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±–µ–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —à–∞–±–ª–æ–Ω–æ–≤.

            –ú–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —ç–ª–µ–º–µ–Ω—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–ø–∞–ø–∫—É –∏–ª–∏ —à–∞–±–ª–æ–Ω) –≤–æ –≤—Ä–µ–º—è –æ–±—Ö–æ–¥–∞ –¥–µ—Ä–µ–≤–∞ —Ä–∞–∑–±–æ—Ä–∞.
            –î–ª—è –ø–∞–ø–æ–∫ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –ø—É—Å—Ç—ã–º–∏ –¥–æ—á–µ—Ä–Ω–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏, –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏
            —Ç–æ–ª—å–∫–æ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (–±–µ–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ).

            Args:
                ctx (STFileParser.EntryContext): –ö–æ–Ω—Ç–µ–∫—Å—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    –æ –ø–∞–ø–∫–µ –∏–ª–∏ —à–∞–±–ª–æ–Ω–µ, –ø–æ–ª—É—á–µ–Ω–Ω—É—é –æ—Ç –ø–∞—Ä—Å–µ—Ä–∞.

            Behavior:
                - –î–ª—è –ø–∞–ø–æ–∫ (folderHeader): —Å–æ–∑–¥–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç —Å –∏–º–µ–Ω–µ–º, —Ç–∏–ø–æ–º 'folder' –∏ –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º –¥–µ—Ç–µ–π,
                –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–µ–∫ –∏ —Ç–µ–∫—É—â–µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏.
                - –î–ª—è —à–∞–±–ª–æ–Ω–æ–≤ (templateHeader): —Å–æ–∑–¥–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç —Å –∏–º–µ–Ω–µ–º, —Ç–∏–ø–æ–º 'template' –∏ –ø—É—Å—Ç—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º,
                –¥–æ–±–∞–≤–ª—è–µ—Ç –∫ —Ç–µ–∫—É—â–µ–º—É —Ä–æ–¥–∏—Ç–µ–ª—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–µ–∫–∞.

            Notes:
                - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–º–µ–Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ª–∏—Ç–µ—Ä–∞–ª–æ–≤, —É–¥–∞–ª—è—è –æ–∫—Ä—É–∂–∞—é—â–∏–µ –∫–∞–≤—ã—á–∫–∏.
                - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —à–∞–±–ª–æ–Ω–æ–≤ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É).
                - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º —Å—Ç–µ–∫–∞.

            Example:
                –î–ª—è –≤—Ö–æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞:
                    folder "MyFolder" { ... }
                –°–æ–∑–¥–∞–µ—Ç:
                    {'name': 'MyFolder', 'type': 'folder', 'children': []}

                –î–ª—è –≤—Ö–æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞:
                    template "MyTemplate" "content ignored"
                –°–æ–∑–¥–∞–µ—Ç:
                 {'name': 'MyTemplate', 'type': 'template', 'content': ''}
            """
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É template —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
        if ctx.folderHeader():
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–ø–∫–∏ (–∫–∞–∫ –æ–±—ã—á–Ω–æ)
            header = ctx.folderHeader()
            name = header.STRING(0).getText()[1:-1]

            new_item = {
                'name': name,
                'type': 'folder',
                'children': []
            }
            self.current_parent['children'].append(new_item)
            self.stack.append(new_item)
            self.current_parent = new_item

        elif ctx.templateHeader():
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ —à–∞–±–ª–æ–Ω–∞, –Ω–æ –±–µ–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
            header = ctx.templateHeader()
            name = header.STRING(0).getText()[1:-1]

            # –î–æ–±–∞–≤–ª—è–µ–º template –±–µ–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
            self.current_parent['children'].append({
                'name': name,
                'type': 'template',
                'content': ""  # –ü—É—Å—Ç–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            })