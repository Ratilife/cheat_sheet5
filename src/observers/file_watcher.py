import os
from PySide6.QtCore import QFileSystemWatcher, Signal, QObject

class FileWatcher(QObject):
    # TODO üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ: 08.08.2025
        # üèÜtask: –°–æ–∑–¥–∞–Ω–∏–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏;
        # üèÜtask: –û—Ç–∫—Ä—ã—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –∏–∑ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏;
        # üèÜtask: –†–∞–±–æ—Ç–∞ —Å –¥–µ—Ä–µ–≤–æ–º:
    """–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤."""
    file_updated = Signal(str)  # –§–∞–π–ª –∏–∑–º–µ–Ω—ë–Ω (–ø—É—Ç—å)
    file_deleted = Signal(str)  # –§–∞–π–ª —É–¥–∞–ª—ë–Ω (–ø—É—Ç—å)
    directory_changed = Signal(str)  # –ü—É—Ç—å –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

    def __init__(self):
        # TODO üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ: 08.08.2025
        super().__init__()
        self.watcher = QFileSystemWatcher
        self.watcher.fileChanged.connect(self._handle_file_change)

    def _handle_file_change(self, path: str) -> None:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞."""
        # TODO üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ: 08.08.2025
        # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—É—Ç—å (—Ñ–∞–π–ª –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è) –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
        if os.path.exists(path):
            # –ï—Å–ª–∏ –ø—É—Ç—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç (–≤—ã–∑—ã–≤–∞–µ—Ç) —Å–∏–≥–Ω–∞–ª/—Å–æ–±—ã—Ç–∏–µ –æ —Ç–æ–º, —á—Ç–æ —Ñ–∞–π–ª –±—ã–ª –æ–±–Ω–æ–≤–ª—ë–Ω
            self.file_updated.emit(path)
        else:
            # –ï—Å–ª–∏ –ø—É—Ç—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (—Ñ–∞–π–ª –±—ã–ª —É–¥–∞–ª—ë–Ω), –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç (–≤—ã–∑—ã–≤–∞–µ—Ç) —Å–∏–≥–Ω–∞–ª/—Å–æ–±—ã—Ç–∏–µ –æ —Ç–æ–º, —á—Ç–æ —Ñ–∞–π–ª –±—ã–ª —É–¥–∞–ª—ë–Ω
            self.file_deleted.emit(path)